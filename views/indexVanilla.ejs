<!DOCTYPE html>
<html>

<head>
    <title>
    </title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/6ea2cb925f.js" crossorigin="anonymous"></script>
    <style>
        .sort-icon {
            margin-left: 5px;
        }

        .sort-icon.asc:before {
            content: "\f0de";
        }

        .sort-icon.desc:before {
            content: "\f0dd";
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>BREADS (Browse, Read, Update, Delete, Sort)</h1>
        <h4>Add Data</h4>
        <form id="create-form">
            <input type="hidden" name="page" value="1">
            <div class="row mb-3">
                <label for="inputId" class="col-sm-4 col-form-label">
                    ID
                </label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" id="id" name="id">
                </div>
            </div>
            <div class="row mb-3">
                <label for="inputStr" class="col-sm-4 col-form-label">
                    String
                </label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" id="string" name="string">
                </div>
            </div>
            <div class="row mb-3">
                <label for="inputInt" class="col-sm-4 col-form-label">
                    Integer
                </label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" id="integer" name="integer">
                </div>
            </div>
            <div class="row mb-3">
                <label for="inputFloat" class="col-sm-4 col-form-label">
                    Float
                </label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" id="float" name="float">
                </div>
            </div>
            <div class="row mb-3">
                <label for="inputDate" class="col-sm-4 col-form-label">
                    Date
                </label>
                <div class="col-sm-4">
                    <input type="date" class="form-control" id="startDate" name="startDate">
                </div>
            </div>
            <div class="row mb-3">
                <label for="inputBol" class="col-sm-4 col-form-label">
                    Boolean
                </label>
                <div class="col-sm-8">
                    <select name="boolean" id="boolean" class="form-select">
                        <option>Choose the boolean</option>
                        <option value="true">True</option>
                        <option value="false">False</option>
                    </select>
                </div>
            </div>
            <!-- <button class="btn btn-primary">Search</button> -->
            <button type="submit" class="btn btn-primary">Add</button>
            <a href="/" class="btn btn-secondary">Back</a>
        </form>
    </div>
    <br>
    <div class="container">
        <table class="table table-striped table-bordered">
            <thead>
                <tr align="center">
                    <th>
                        ID
                        <a href="">
                            <span class="fa fa-sort"></span>
                        </a>
                    </th>
                    <th>
                        String
                        <a href="">
                            <span class="fa fa-sort"></span>
                        </a>
                    </th>
                    <th>
                        Integer
                        <a href="">
                            <span class="fa fa-sort"></span>
                        </a>
                    </th>
                    <th>
                        Float
                        <a href="">
                            <span class="fa fa-sort"></span>
                        </a>
                    </th>
                    <th>
                        Date
                        <a href="">
                            <span class="fa fa-sort"></span>
                        </a>
                    </th>
                    <th>
                        Boolean
                        <a href="">
                            <span class="fa fa-sort"></span>
                        </a>
                    </th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="data-body">
            </tbody>
        </table>
        <br>
        <div class="pagination" id="pagination">
        </div>
    </div>

    <script type="text/javascript">
        // document.addEventListener('DOMContentLoaded', () => {
        //     const createForm = document.getElementById('create-form');
        //     createForm.addEventListener('submit', createData);
        //     readData()
        // })
        document.getElementById('create-form').addEventListener("submit", function (event) {
            event.preventDefault();
            const number = document.getElementById('id').value
            const string = document.getElementById('string').value
            const integer = document.getElementById('integer').value
            const float = document.getElementById('float').value
            const date = document.getElementById('startDate').value
            const boolean = document.getElementById('boolean').value
            createData(number, string, integer, float, date, boolean)
        })
        async function readData() {
            try {
                const response = await fetch(`http://localhost:3100/data`);
                if (response.ok) {
                    const data = await response.json();
                    // Display data
                    displayData(data)

                } else {
                    throw new Error("Error: " + response.status);
                }
            } catch (error) {
                console.log(error)
            }
        }
        function displayData(data) {
            let html = "";
            data.data.forEach((item, index) => {
                html += `
        <tr>
            <td>${item.number}</td>
            <td>${item.string}</td>
            <td>${item.integer}</td>
            <td>${item.float}</td>
            <td>${item.date}</td>
            <td>${item.boolean}</td>
            <td>
                <button class="btn btn-success btn-sm" onclick="updateData('${item._id}')">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteData('${item._id}')">Hapus</button>
            </td>
        </tr>`
            });
            document.getElementById('data-body').innerHTML = html;
        }

        async function createData(number, string, integer, float, date, boolean) {
            try {

                const data = {
                    number: number,
                    string: string,
                    integer: integer,
                    float: float,
                    date: date,
                    boolean: boolean
                };

                if (!number || !string || !integer || !float || !date || !boolean) {
                    alert('Please, Insert the data')
                    return
                }

                const response = await fetch('http://localhost:3100/data', {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    const result = await response.json();
                    console.log("Success:", result);
                    const number = document.getElementById('id').value = ''
                    const string = document.getElementById('string').value = ''
                    const integer = document.getElementById('integer').value = ''
                    const float = document.getElementById('float').value = ''
                    const date = document.getElementById('startDate').value = ''
                    const boolean = document.getElementById('boolean').value = ''
                    readData()
                } else {
                    console.error('Error creating data');
                }

            } catch (error) {
                console.log(error)
            }
        }

        async function updateData(id) {
            try {
                const number = document.getElementById('id').value; // Assuming 'number' is the ID of the input field for the number value
                const string = document.getElementById('string').value;
                const integer = document.getElementById('integer').value;
                const float = document.getElementById('float').value;
                const date = document.getElementById('startDate').value;
                const boolean = document.getElementById('boolean').value;
                const data = {
                    number: number,
                    string: string,
                    integer: integer,
                    float: float,
                    date: date,
                    boolean: boolean
                }
                if (!number || !string || !integer || !float || !date || !boolean) {
                    alert('Please,Insert the data')
                    return
                }
                const response = await fetch(`http://localhost:3100/data/${id}`,{
                    method:'PUT',
                    headers:{
                        'Content-Type' : 'application/json'
                    },
                    body:JSON.stringify(data)
                })
                if (response.ok) {
                    const result = await response.json();
                    console.log("Success: ", result)
                    // Clear the input fields
                    document.getElementById('id').value = '';
                    document.getElementById('string').value = '';
                    document.getElementById('integer').value = '';
                    document.getElementById('float').value = '';
                    document.getElementById('startDate').value = '';
                    document.getElementById('boolean').value = '';
                    readData()
                }
            } catch (error) {
                console.log(error)
            }
        }
        async function deleteData(id) {
            try {
                const response = await fetch(`http://localhost:3100/data/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id })
                });

                if (response.ok) {
                    const result = await response.json();
                    // Handle the created data
                    console.log("Success:", result);
                    readData()
                } else {
                    throw new Error('Error: ' + response.status);
                }
            } catch (error) {
                console.log(error);
            }
        }
        readData()
    </script>
</body>

</html>